<html>
<head>
    <title>Apple Products - React Detail UI</title>

    
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>

    <!-- Babel for JSX support -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>

<body>

<div id="root"></div> <!-- React will render here -->

<script type="text/babel">
    let items;
    try {
        items = JSON.parse(`<%- JSON.stringify(items) %>`);
        console.log("✅ Received items:", items);
    } catch (error) {
        console.error("❌ Error parsing items:", error);
        items = []; // Prevents crash if data is missing
    }

    // Detail Component - Displays and allows editing of selected product
    const Detail = ({ selectedItem, onClear, onEdit }) => {
        if (!selectedItem) return <p>Select an item to see details.</p>;

        return (
            <>
                <h2>Item Details</h2>
                <form>
                    <label>
                        Name:
                        <input 
                            type="text" 
                            value={selectedItem.name || ""} 
                            onChange={(e) => onEdit('name', e.target.value)}
                        />
                    </label>
                    <br />
                    <label>
                        ID:
                        <input 
                            type="text" 
                            value={selectedItem.id || ""} 
                            disabled
                        />
                    </label>
                    <br />
                    <label>
                        Price:
                        <input 
                            type="number" 
                            value={selectedItem.price || ""} 
                            onChange={(e) => onEdit('price', e.target.value)}
                        />
                    </label>
                    <br />
                    <label>
                        Year:
                        <input 
                            type="number" 
                            value={selectedItem.year || ""} 
                            onChange={(e) => onEdit('year', e.target.value)}
                        />
                    </label>
                    <br />
                    <button type="button" onClick={onClear}>Clear</button>
                </form>
            </>
        );
    };

    // Product List Component
    const ProductList = ({ products, onSelect }) => {
        return (
            <>
                <h2>Apple Products</h2>
                {products.length === 0 ? (
                    <p>No items found.</p>
                ) : (
                    <ul>
                        {products.map((product) => (
                            <li key={product.id} onClick={() => onSelect(product)} style={{ cursor: "pointer" }}>
                                <span>{product.name}</span>
                            </li>
                        ))}
                    </ul>
                )}
            </>
        );
    };

    // Main App Component
    const App = () => {
        console.log("✅ React is running!");

        const [selectedItem, setSelectedItem] = React.useState(null);

        const handleSelect = (item) => {
            setSelectedItem({ ...item }); // Creates a copy to allow state updates
        };

        const handleClear = () => {
            setSelectedItem(null);
        };

        const handleEdit = (field, value) => {
            setSelectedItem((prevItem) => ({
                ...prevItem,
                [field]: value,
            }));
        };

        return (
            <div style={{ display: "flex", flexDirection: "column", gap: "20px", padding: "20px" }}>
                <div>
                    <ProductList products={items} onSelect={handleSelect} />
                </div>
                <div>
                    <Detail selectedItem={selectedItem} onClear={handleClear} onEdit={handleEdit} />
                </div>
            </div>
        );
    };

    // Render React App inside "root" div
    ReactDOM.render(<App />, document.getElementById('root'));
</script>

</body>
</html>
